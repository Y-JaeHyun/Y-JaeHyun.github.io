---
layout:     post
title:      싱글턴 패턴(Singleton Pattern)
author:     bcnote3314
subtitle:  	디자인 패턴
tags: 		designpattern
category: Pattern
---

## 단 하나의 인스턴스가 필요할 때?

개발을 하다보녀 반드시 하나의 인스턴스만 존재핵야 하는 경우가 있다.  

스레드 관리를 위한 객체나, 캐시, config 등 다수의 인스턴스가 존재할 경우 프로그램이 의도된바와 같이 동작하지 않거나 불필요하게 자원을 많이 사용할 수 있다.
싱글턴 패턴은 특정 클래스에 대해서 객체를 하나만 생성하는 것을 보장해주며, 전역변수와 마찬가지로 객체 인스턴스를 어디서든 액세스 할수 있다는 장점이 있다.  

그에 비해 전역변수 사용시 발생하는 단점들 역시 보완된다.  


## 고전적인 싱클턴 패턴

> 싱글턴 패턴 - 해당 클래스의 인스턴스가 하나만 만들어지고, 어디서든지 그 인스턴스에 접근할 수 있도록 하기 위한 패턴

우선 이책은 자바를 기준으로 설명하기 때문에 다른 전체적인 의도나 개념등을 이해하고 실제 구현은 언어에 따라 다를수 있다.  
책에서 고전적인 구현 방법으로 생성자를 private으로 감추고 static 메소드를 통해 객체를 전달하는 방식으로 단일 객체만을 유지할 수 있도록 구현했다.  

하지만 내가 주로 사용하는 Python에서는 동일한 형태로 구현은 어렵다는 생각이 들었다.  
우선 아래는 책에서 소개하는 고전 싱클턴 패턴의 클래스 다이어 그램이다.  

![싱글턴](http://drive.google.com/uc?export=view&id=18yCvDuGEys5s2Wt_THAobsirJ5kqEOHe)


getInstance 함수에서는 uniqueInstance의 존재 여부를 판단한뒤 없다면 객체를 생성해서 전달해주며, 있다면 존재하는 객체를 돌려줌으로써 하나의 인스턴스를 보장한다.


## 멀티 스레드 환경

위의 형태에서 조심해야 하는 문제는 멀티스레드 환경에서 동기화 문제다.  
getInstance 함수 내에서 uniqueInstance의 인스턴스 존재 여부를 판단할 때 Lock 없이 다수의 스레드에서 접근되는 경우 다수의 객체가 생성되어 return되는 불상사가 발생할 수 있다.  

해결 방법은 당연히 동기화 처리를 하거나, 문제가 되지 않는 경우 미리 객체를 만들어 두는것도 방법이 될수 있다.


## Python에서의 싱글턴


Python에서는 싱글턴을 어떻게 구현 해야할까?  

[Stackoverflow-python singleton](https://stackoverflow.com/questions/6760685/creating-a-singleton-in-python)

다양한 형태의 구현 방법이 있다.  
이중 metaclass를 이용한 방법이 있는데, metaclass란 클래스를 생성하기 위한 클래스이다..  

말이 어렵다..  
Python 에서는 클래스 자체도 객체 취급을 한다.
클래스를 통해서 인스턴스 객체를 만들듯이 메타 클래스를 통해서 클래스 객체를 만드는 것이 가능하다.  

metaclass를 구현하는 방법은 두 가지 방법이 있다.  

1. type을 사용하여 동적으로 클래스를 생성한다.
2. type을 상속받아 메타클래스를 구현한다.

대표적인 metaclass는 추상클래스로 사용하기 위한 ABCMeta가 있다.  
ABCMeta가 해당 클래스를 추상 클래스로 지정하고 메소드의 구현을 하위 클래스에서 강제하는 것처럼 인스턴스를 하나만 강제하는 것도 당연히 가능하다. 

