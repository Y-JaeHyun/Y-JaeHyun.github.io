
layout:     post
author:     bcnote3314
title:  성능을 올리기 위한 삽질 기록
subtitle: 메모리 구조
category: Experiences
---

# 1. Cache Memory 활용

## Cache Memory 특성 

캐시메모리의 특성은 작고 빠르다는 것이다.  
컴퓨터에 들어가는 메모리 특성을 가진 부품을 크게 나누면 3가지가 있다.  

CPU(의 Cache Memory), RAM, HDD

앞에 있을수록 속도에 가중을 주며, 뒤로갈수록 용량에 가중을 주었다는 차이가 있다.  
용량이 작은 메모리를 잘 활용하는 특성이 지역성(Locality)이다. 

지역성은 크게 시간적 지역성과, 공간적 지역성 두 가지로 나뉜다.  
시간적 지역성은 최근에 액세스된 주소가 가까운 미래에 다시 엑세스 될 가능성이 높다는 개념이며,  
공간적 지역성은 액세스된 주소와 인접한 주소가 액세스 될 가능성이 높다는 개념이다.

캐시메모리에 Write 동작이 발생한다면?
Write Policy에 의하여 동작의 차이가 발생한다.  
Write Through : 캐시의 변화를 바로 Main Memory에도 Write 해준다. 일관성 측면에서 장점이나 상대적으로 속도가 느린 메모리의 IO 처리를 대기해야 하기 때문에 성능이 떨어진다. 
Write Back : 변경사항을 캐시에만 기록하고 실제 해당 블록이 해제될때 Main Memory 한번에 Write한다. 상대적으로 IO 빈도가 낮기 때문에 성는ㅇ이 좋지만 캐시와 메모리간의 값이 일치하지 않는다.

이외에도 Replacement Algorithms등 알아두면 좋은 개념이 많다. (나중에 개념정리..)

## 메인 메모리 구조

기본적으로 메모리는 4개의 영역으로 나뉜다.  
(흔히 OS나 메모리관련 설명에서 자주보는 그림이다.)

![메모리 영역]() 

Text : 코드영역이라고도 하며 유저가 작성한 코드 즉 실행한 코드가 저장되는 공간이다. 
Data : 전역 변수, 정적 변수가 할당되는 공간이다.
Heap : C로 치면 malloc과 같이 프로그램 실행중에 동적으로 사용되는 공간이다.
Stack : 환경변수, 지역변수, 파라미터등의 정보를 담고 있다.

여기서 Cache를 활용하기 위해 고심해봐야 할 것은 Data영역과 Heap 영역이다.  
캐시메모리의 지역성이라는 특징을 잘 활용하기 위해서 Data영역과 Heap 영역을 과도하게 사용하는 것은 지양해야 할것이다.


## 왜 Data랑 Heap일까?

대부분의 프로그램은 작성된 코드를 순차적으로 실행한다.  
즉 동작하는 함수에서 접근하는 데이터도 순차적으로 접근을 하게 될텐데, 지역변수로 선언된 변수들의 접근은 모두 공간적 지역성 특성에 의해 캐시에 데이터가 존재할 확률이 높다.  

하지만 전역변수나, 동적할당 받은 변수의 경우에는 최초 접근시에 항상 캐시에 존재할 수 없는 데이터이다.  


