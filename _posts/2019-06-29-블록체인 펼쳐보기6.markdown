---
layout:     post
title:      블록체인 펼쳐보기 - 6
author:     bcnote3314
tags: 		blockchain 블록체인펼쳐보기
subtitle:  블록체인 정복기	
category: Block
---

# 블록체인 펼쳐보기 - Chapter 06(2)

블록체인 펼쳐보기 챕터 6에 대한 내용 정리 -2

## 블록체인에서의 디지털 서명(digital signature)

공개키를 이용해서 내가 작성한 것임을 증명할수 있는 디지털 서명을 할수 있다고 했다.
실제 블록체인에서 사용한다고 가정하고 A가 B에게 1BTC 중 0.3BTC를 지불하는 거래를 한다고 가정하자.

![서명1](http://drive.google.com/uc?export=view&id=1b2yaOEgWEliV9bwqn6sOH1E4A2dTJ89V)

우선 출력에는 비트코인의 잔액과 그 주인의 공개키가 들어있다. 다음 거래에서 이 출력에 있는 코인을 사용하고자 하면 자신을 증명해야한다.
증명의 방법은 공통의 String을 하나 정한뒤에 개인키로 해당 String을 암호화 한다. 그 다음 출력에 존재하는 공개키를 이용하여 복호화 하였을때 동일한 String이라면 소유권이 인정되는 것이다.

해당 코인을 사용하여 타인에게 송금을 할때에는 출력부에 코인의 액수와 그사람의 공개키를 적어주면 그다음엔 계속 동일하게 동작할수 있다. 물론 잔액은 내 공개키로 출력에 작성해 주어야 한다.

이러한 동작에는 큰 문제점이 있다.
블록체인에서 모든 정보는 공개되어있다. 결론적으로는 내가 특정 String을 내 개인키로 암호화하여 서명으로 사용하려고 하는데 그 서명 역시도 공개되어 있는 정보다.
결론적으로 서명을 중복해서 사용하지 못하도록 String이 계속 바뀌어야 한다.

매 거래마다 바뀌는 정보가 무엇일까 보면 **Transaction ID(TXID)** 가 존재한다. 매 거래마다 ID가 바뀌기 때문에 사용하기 좋아 보인다. 또한 하나의 거래에서 출력내용이 여러개 존재하기 때문에 그 출력에 대한 ID도 같이 사용한다.

![서명2](http://drive.google.com/uc?export=view&id=1OQ9PMPiak5BFDN8HGTcJijdlMLIfU3Fl)

## UTXO(unspent Transaction Output)

매번 **TXID**가 바뀌더라도 만약 같은 거래장부안에 있는 코인중 일부만 사용하고 나머지는 나중에 다시 접근해서 사용하려고 한다면?
String이 동일했을때와 마찬가지로 TXID와 출력ID가 동일하기 때문에 서명을 타인이 사용할수가 있게된다.

이런 것을 막기 위하여 비트코인에서는 모든 코인은 단 한번만 사용할수 있도록 정해두었다.(즉 일회용이다.) 그렇기 때문에 잔액에 대한 부분을 필수적으로 남겨야 하는 것이다.
아직 한번도 사용하지 않은 상태의 코인을 **UTXO**라고 한다.

다수의 UTXO를 모아서 거래를 하는 것도 가능하다. 입력부에 필요한 UTXO를 모두 정의하고 출력에는 또 전송자와 남은 잔액에 대한 처리를 해주면 되는 것이다. 다수의 UTXO는 모두 사라지고 출력부에 적은 형태로만 최종적으로 남는다.
다수의 공개키를 사용하는 것도 가능하다. 한사람이 하나의 공개키만 사용해야한다는 제한이 없고 어차피 비트코인에서는 사용자의 정체를 중요하게 생각하지 않기 때문에 그저 비밀키로 접근할수만 있으면 만사 OK.

블록체인은 기록들을 연결해서 계속 쌓아가는 방식이다. 현재 내가 가지고 있는 UTXO가 어떤 과정을 거쳐서 만들어졌는지 기록이 남아있다. (코인은 사용할수 없게 되었지만 기록자체는 유지된다.)

## 거래 기록의 검증

거래가 전파될 때 노드들은 입력무에 적힌 코인이 UTXO인지 확인한다. UTXO가 아니라면 이미 기존에 사용된 것이기 때문에 불법이라 판단하며 더이상 전파하지 않는다.
즉 모든 노드들은 어떤 코인이 UTXO인지 항상 알고 있어야하며 상태의 업데이트 또한 해줘야한다.
물론 이런 일은 새 블록을 만드는 채굴 노드에서만 수행하면 된다.

잘못된 거래 기록도 검증해야한다. 출력부에 적힌 코인의 합산은 입력부의 적힌 코인의 합을 넘어갈수 없다. 이와같이 거래 형식에 맞게 잘 작성된 장부인지를 확인하는 것도 채굴노드들이 수행할 일이다.

## 거래 수수료

비트코인 거래에는 수수료가 있다. 거래가 블록에 포함되어 기존체인에 연결되었을때 채굴자는 채굴보상금과 함께 블록에 포함된 거래 내역의 수수료들도 같이 받는다.
수수료는 따로 적는 것은 아니며 입력값에서 총 출력값을 뺀 차액이다. 이것은 거래 당사자들이 자유롭게 결정한다.

채굴 노드들이 거래 기록을 재료로 새 블록이 만들기 때문에 수수료가 높을수록 채굴이 빠르게 될 확률이 높다. (어떤 거래를 채굴할 것인지느 전적으로 채굴 노드의 맘이다.)
이러한 수수료도 역시 블록이 100개 쌓여있어야 지불이 된다. (즉 같은 거래가 어러범 채굴되어도 실제로는 이후 살아남는 하나의 블록의 채굴자만 받을 것이다.)

비트코인에는 채굴 보상금의 한도가 정해져 있다. 이러한 보상금이 모두 사용되고나면 실제 채굴자들이 얻는 이득은 이러한 수수료가 되겠지?


