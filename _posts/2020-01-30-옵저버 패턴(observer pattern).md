---
layout:     post
title:      옵저버 패턴(observer pattern)
author:     bcnote3314
subtitle:  	디자인 패턴
tags: 		designpattern
category: Pattern
---


## 옵저버 패턴(observer pattern)

옵저버 패턴은 신문 구독과 많이 비유해서 표현한다.  
신문은 구독신청을 하면 신문사에서 매일 새로운 신문을 집으로 배달을 해준다.  
이것은 매일 반복되고 구독을 해지하게 되면 더이상 신문을 보내지 않는다.
신문사는 다수의 고객들을 관리를 하고 그 고객들에게 신문을 역할을 한다.

옵저버 패턴도 이와 비슷한 이치다.  
무언가 감시하는 데이터의 변화가 발생하는지 관리하는 주제(subject)객체가 있다.  
이 주제 객체는 신문사 역할을 하며 다른 객체들이 옵저버로 참여 혹은 탈퇴에 대한 관리를 하고, 옵저버들에게 데이터의 변화를 전달해준다.  
옵저버(observer) 객체들은 주제 객체에 등록/탈퇴를 요청하여 변화된 데이터를 전달받게 되는 형태를 보인다.

옵저버 패턴의 정확한 정의는 아래와 같다.

> 한 객체의 상태가 바뀌면 그 객체에 의존하는 다른 객체들한테 연락이 가고 자동으로 내용이 갱신되는 방식으로 일대다(one-to-many) 의존성을 정의한다.

## 일대다?

일대다 관계라는 것은 주제와 옵저버에 의하여 정의되는 형태다.
옵저버는 주제에 의존하게 되며, 주제의 상태의 변경이 옵저버에게 전달되는 방식이다.

## 느슨한 결합(Loose Coupling)

두 객체가 느슨하게 결합이 되어 있다는 것은 둘이 상호작용을 하긴 하지만 서로에 대하여 잘 모르는 것을 의미한다.  
옵저버 패턴이 느슨한 결합의 대표적인 예이다.

주제는 옵저버에 대하여 아는것이 거의 없다. 단순히 특정 인터페이스를 구현한것 뿐이라는 정도만 안다.  
그외의 다른 정보는 알 필요가 없다.
옵저버는 언제든지 새로 추가 될수 있고 새로운 형식의 옵저버가 추가되려고 할 때도 주제를 전혀 변경할 필요가 없다.

> 서로 상호작용을 하는 객체 사이에서는 가능하면 느슨하게 결합하는 디자인을 사용 해야 한다.

즉, 느슨한 결합은 변경사항이 생기더라도 무난히 처리할 수 있는 유연한 객체지향 시스템을 구축 할수 있다.

## 옵저버 패턴 클래스 다이어 그램

![옵저버](http://drive.google.com/uc?export=view&id=1ng2uT6hoH2umo56FCox1phOKT4puwo4u)

## 자바의 옵저버 패턴

자바의 경우 이미 내장으로 옵저버 패턴을 구현한 것이 있다.

Observable 클래스와 observer 인터 페이스를 통하여 사용 가능하다.  
이부분은 내가 자바 개발자는 아니기 때문에 따로 정리하진 않지만 기본적으론 대부분 위와 동일하며 다만 데이터 전달 방식이 주제에서 배포하는 방식과 옵저버가 직접 가저가는 방식 모두 지원한다고 한다.

## 느낀점

옵저버 패턴은 회사에서 비슷한 형태의 코드를 많이 본적이 있다.  
물론 이런 패턴을 알고 개발한건지 감으로 한건지 알수는 없지만..  

이 구조를 보고 가장 먼저 떠오르는건 SNMP였다.  
Simple Network Management Protocol, 네트워크 장비에 뭔가 특이사항이 있을때 메세지를 전달해주는 프로토콜이다.  

네트워크 장비의 다양한 부분(Power, Fan, HDD 장애 등등 이건 구현한 장비마다 모두 제공하는 정보가 다르며 이는 따로 MIB이라는 별도의 해석을 위한 파일과 매칭되서 볼수 있다.)들의 상태를 주기적으로 봐야한다.  
이때 사용한 방식이 특정 정보들을 주기적으로 읽어드리는 프로세스가 있고, 해당 프로세스가 관련 정보들을 공유메모리에 올려주었다.

net-snmp에서 지원하는 agent에서는 해당 공유메모리에서 필요한 정보들을 획득해서 사용자가 요청한 정보들을 제공해준다.  
공유메모리에는 net-snmp에서 지원하는 항목 말고도 수많은 데이터들이 들어 갈수 있고, net-snmp 외에도 다른 프로세스들이 해당 공유메모리를 참조하여 관련 정보를 활용 할 수 있다.

주제가 옵저버를 관리하거나, 옵저버들끼리의 동일한 인터페이스가 있는것은 아니지만..

C로 표현해본 Observer Pattern (진행중... 갑자기 또 바빠서 시간이 )
